# Makefile automatically generated by ghdl
# Version: GHDL 0.36 (v0.36) [Dunoon edition] - GCC back-end code generator
# Command used to generate this makefile:
# ghdl --gen-makefile lan9254esctb


CROSS=
GHDL=$(CROSS)ghdl
CXX=$(CROSS)g++
GHDLFLAGS=$(addprefix -P,$(UNISIM))

SIITOOL=siitool

-include config.local.mk

PROG+=lan9254escrun lan9254esctb txmbxtb eoetb
PROG+=strmframebuftb udp2bustb devicedna7tb
PROG+=udp2busmuxtb
PROG+=escfoetb strmfifosynctb

EVRPDO_S:=EvrTxPDO.vhd EvrTxPDOPkg.vhd EvrTxPDOSimWrapper.vhd

EVRPDO_O:=$(subst .vhd,.o,$(and $(wildcard EvrTxPDO.vhd),$(wildcard EvrTxPDOPkg.vhd),$(EVRPDO_S)))

OBJS+=ESCBasicTypesPkg.o
OBJS+=Lan9254Pkg.o Lan9254ESCPkg.o Lan9254ESC.o Lan9254Hbi.o Lan9254HbiSoft.o
OBJS+=readWriteSim.o EEEmulPkg.o EEPROMContentPkg.o RxPDOSoft.o IlaWrappersPkg.o
OBJS+=ESCMbxPkg.o ESCEoERx.o ESCTxMbxBuf.o ESCRxMbxMux.o ESCTxMbxMux.o ESCTxMbxErr.o
OBJS+=ESCEoETx.o ESCSmRx.o MicroUDPPkg.o MicroUDPRx.o MicroUDPTx.o IPV4ChkSum.o
OBJS+=ESCTxPDO.o Lan9254ESCWrapper.o MicroUDPIPMux.o ESCTxMbx.o StrmFrameBuf.o
OBJS+=Udp2BusPkg.o Udp2Bus.o Lan9254UdpBusPkg.o Udp2BusMux.o DeviceDna7.o
OBJS+=AddressGenerator.o IPAddrConfigPkg.o SynchronizerBit.o $(EVRPDO_O)
OBJS+=ESCFoE.o
OBJS+=StrmFifoSync.o
OBJS+=ESCFoEPkg.o

TOPS+=Lan9254ESCTb.o  Lan9254ESCrun.o TxMBXTb.o EoETb.o StrmFrameBufTb.o
TOPS+=Udp2BusTb.o DeviceDna7Tb.o Udp2BusMuxTb.o ESCFoETb.o StrmFifoSyncTb.o

# Default target
all: $(PROG)

#StrmFifoSync.o: StrmFifoSync.vhd
#	$(GHDL) -a -fsynopsys $^

# Elaboration target
lan9254escrun: $(OBJS) Lan9254ESCrun.o
	$(GHDL) -e -fsynopsys -Wl,readWriteSim.o $(GHDLFLAGS) $@

# Elaboration target
lan9254esctb: $(OBJS) Lan9254ESCTb.o
	$(GHDL) -e $(GHDLFLAGS) $@

udp2busmuxtb: $(OBJS) Udp2BusMuxTb.o
	$(GHDL) -e $(GHDLFLAGS) $@

txmbxtb: $(OBJS) TxMBXTb.o
	$(GHDL) -e $(GHDLFLAGS) $@

readWriteSim.o: readWriteSim.c
	$(CXX) -c -o $@ $^ -Wall

eoetb: $(OBJS) EoETb.o
	$(GHDL) -e $(GHDLFLAGS) $@

strmframebuftb: StrmFrameBufTb.o $(OBJS)
	$(GHDL) -e $(GHDLFLAGS) $@

udp2bustb: Udp2BusTb.o $(OBJS)
	$(GHDL) -e $(GHDLFLAGS) $@

devicedna7tb: DeviceDna7Tb.o DeviceDna7.o
	$(GHDL) -e $(GHDLFLAGS) $@

escfoetb: ESCFoETb.o $(OBJS)
	$(GHDL) -e $(GHDLFLAGS) -fsynopsys $@

strmfifosynctb: StrmFifoSyncTb.o $(OBJS)
	$(GHDL) -e $(GHDLFLAGS) -fsynopsys $@

# Run target
run: $(PROG)
	$(GHDL) -r $(PROG) $(GHDLRUNFLAGS)

# old method - now use the tool
#EEPROMContentPkg.vhd: eeprom.bin gen-prom.awk
#	od -Ad -tu2 --endian=little -w2 -v $< | awk -f gen-prom.awk > $@

EEPROMContentPkg.vhd: ../tool/FirmwareConstantsAuto.py
	../tool/EsiTool.py -VDf

eeprom.bin: test.xml
	$(RM) $@
	$(SIITOOL) -m -o $@ $<

# Targets to analyze files
##MMRxPDOSoft.o: RxPDOSoft.vhd
##MM	$(GHDL) -a $(GHDLFLAGS) $<
##MMEEPROMContentPkg.o: EEPROMContentPkg.vhd
##MM	$(GHDL) -a $(GHDLFLAGS) $<
##MMIlaWrappersPkg.o: IlaWrappersPkg.vhd
##MM	$(GHDL) -a $(GHDLFLAGS) $<
##MMEEEmulPkg.o: EEEmulPkg.vhd
##MM	$(GHDL) -a $(GHDLFLAGS) $<
##MMLan9254Pkg.o: Lan9254Pkg.vhd
##MM	$(GHDL) -a $(GHDLFLAGS) $<
##MMLan9254ESCPkg.o: Lan9254ESCPkg.vhd
##MM	$(GHDL) -a $(GHDLFLAGS) $<
##MMLan9254ESC.o: Lan9254ESC.vhd 
##MM	$(GHDL) -a $(GHDLFLAGS) $<
##MMLan9254Hbi.o: Lan9254Hbi.vhd
##MM	$(GHDL) -a $(GHDLFLAGS) $<
##MMLan9254HbiSoft.o: Lan9254HbiSoft.vhd
##MM	$(GHDL) -a $(GHDLFLAGS) $<
##MMLan9254ESCTb.o: Lan9254ESCTb.vhd
##MM	$(GHDL) -a $(GHDLFLAGS) $<
##MMLan9254ESCrun.o: Lan9254ESCrun.vhd
##MM	$(GHDL) -a $(GHDLFLAGS) $<
%.o: %.vhd
	$(GHDL) -a $(GHDLFLAGS) $<

# Files dependences
Lan9254ESC.o:  Lan9254Pkg.o Lan9254ESCPkg.o EEEmulPkg.o RxPDOSoft.o IlaWrappersPkg.o ESCMbxPkg.o ESCTxMbxBuf.o ESCSmRx.o ESCTxPDO.o ESCTxMbx.o
EEEmulPkg.o: EEPROMContentPkg.o Lan9254Pkg.o Lan9254ESCPkg.o
Lan9254Hbi.o:  Lan9254Pkg.o Lan9254ESCPkg.o
Lan9254HbiSoft.o:  Lan9254Pkg.o Lan9254Hbi.o Lan9254ESCPkg.o
Lan9254ESCTb.o:  $(OBJS)
Lan9254ESCrun.o: $(OBJS)
TxMBXTb.o:       $(OBJS)
EoETb.o:         $(OBJS)
StrmFrameBufTb.o: StrmFrameBuf.o
RxPDOSoft.o ESCTxPDO.o: Lan9254ESCPkg.o Lan9254Pkg.o
Lan9254ESCPkg.o: Lan9254Pkg.o ESCBasicTypesPkg.o
ESCTxMbx.o ESCSmRx.o ESCEoERx.o:  Lan9254Pkg.o Lan9254ESCPkg.o ESCMbxPkg.o IPAddrConfigPkg.o ESCBasicTypesPkg.o
ESCEoETx.o:  Lan9254Pkg.o Lan9254ESCPkg.o ESCMbxPkg.o
ESCTxMbxBuf.o:  Lan9254Pkg.o Lan9254ESCPkg.o ESCMbxPkg.o
ESCMbxPkg.o: Lan9254ESCPkg.o
ESCTxMbxMux.o: Lan9254Pkg.o
StrmFrameBuf.o ESCRxMbxMux.o ESCTxMbxErr.o: Lan9254Pkg.o ESCMbxPkg.o
MicroUDPIPMux.o MicroUDPRx.o MicroUDPTx.o: MicroUDPPkg.o Lan9254Pkg.o ESCMbxPkg.o IPV4ChkSum.o
Lan9254ESCWrapper.o:  Lan9254Pkg.o Lan9254ESCPkg.o ESCMbxPkg.o MicroUDPPkg.o Lan9254ESC.o ESCTxMbxMux.o ESCRxMbxMux.o ESCTxMbxErr.o ESCEoERx.o ESCEoETx.o MicroUDPRx.o MicroUDPTx.o MicroUDPIPMux.o Udp2BusPkg.o Udp2Bus.o Lan9254UdpBusPkg.o Udp2BusMux.o AddressGenerator.o ESCFoEPkg.o ESCFoE.o StrmFifoSync.o
MicroUDPPkg.o: Lan9254Pkg.o IPAddrConfigPkg.o
ESCEoETx.o ESCEoERx.o: StrmFrameBuf.o ESCBasicTypesPkg.o
Udp2Bus.o: Udp2BusPkg.o Lan9254Pkg.o StrmFrameBuf.o
Udp2BusMux.o: Udp2BusPkg.o
Udp2BusTb.o: Udp2Bus.o
DeviceDna7Tb.o: DeviceDna7.o
AddressGenerator.o: DeviceDna7.o IPAddrConfigPkg.o
Udp2BusMuxTb.o: Udp2BusMux.o Udp2BusPkg.o
EvrTxPDO.o: SynchronizerBit.o Lan9254ESCPkg.o Udp2BusPkg.o  EvrTxPDOPkg.o
EvrTxPDOSimWrapper.o: EvrTxPDO.o ESCBasicTypesPkg.o
Lan9254Pkg.o: ESCBasicTypesPkg.o
Lan9254UdpBusPkg.o: Udp2BusPkg.o Lan9254Pkg.o
ESCFoE.o: ESCBasicTypesPkg.o Lan9254Pkg.o Lan9254ESCPkg.o ESCMbxPkg.o ESCFoEPkg.o
StrmFifoSync.o: ESCBasicTypesPkg.o Lan9254Pkg.o
ESCFoETb.o: $(OBJS)
StrmFifoSyncTb.o: $(OBJS)
clean:
	$(RM) $(OBJS) $(PROG) dump.ghw work-*.cf $(addprefix e~, $(addsuffix .o,$(PROG))) $(TOPS) EEPROMContentPkg.vhd eeprom.bin $(EVRPDO_S:%.vhd=%.o)

.PHONY: clean all run
